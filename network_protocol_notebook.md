# 网络协议笔记
## TCP/IP协议
### TCP/IP 介绍
TCP/IP 是用于因特网 (Internet) 的通信协议。
#### **计算机通信协议（Computer Communication Protocol）**

计算机通信协议是对那些计算机必须遵守以便彼此通信的的规则的描述。
#### **什么是 TCP/IP？**

TCP/IP 是供已连接因特网的计算机进行通信的通信协议。

TCP/IP 指传输控制协议/网际协议（Transmission Control Protocol / Internet Protocol）。

TCP/IP 定义了电子设备（比如计算机）如何连入因特网，以及数据如何在它们之间传输的标准。
#### **在 TCP/IP 内部**
在 TCP/IP 中包含一系列用于处理数据通信的协议：

* TCP (传输控制协议) - 应用程序之间通信
* UDP (用户数据报协议) - 应用程序之间的简单通信
* IP (网际协议) - 计算机之间的通信
* ICMP (因特网消息控制协议) - 针对错误和状态
* DHCP (动态主机配置协议) - 针对动态寻址
#### **TCP 使用固定的连接**
TCP 用于应用程序之间的通信。

当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方"握手"之后，TCP 将在两个应用程序之间建立一个全双工 (full-duplex) 的通信。

这个全双工的通信将占用两个计算机之间的通信线路，直到它被一方或双方关闭为止。

UDP 和 TCP 很相似，但是更简单，同时可靠性低于 TCP。
#### **IP 是无连接的**
IP 用于计算机之间的通信。

IP 是无连接的通信协议。它不会占用两个正在通信的计算机之间的通信线路。这样，IP 就降低了对网络线路的需求。每条线可以同时满足许多不同的计算机之间的通信需要。

通过 IP，消息（或者其他数据）被分割为小的独立的包，并通过因特网在计算机之间传送。

IP 负责将每个包路由至它的目的地。
#### **IP 路由器**
当一个 IP 包从一台计算机被发送，它会到达一个 IP 路由器。

IP 路由器负责将这个包路由至它的目的地，直接地或者通过其他的路由器。

在一个相同的通信中，一个包所经由的路径可能会和其他的包不同。而路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址。
#### **TCP/IP**

TCP/IP 意味着 TCP 和 IP 在一起协同工作。

TCP 负责应用软件（比如您的浏览器）和网络软件之间的通信。

IP 负责计算机之间的通信。

TCP 负责将数据分割并装入 IP 包，然后在它们到达的时候重新组合它们。

IP 负责将包发送至接受者。
### TCP/IP 寻址

TCP/IP 使用 32 个比特或者 4 组 0 到 255 之间的数字来为计算机编址。
#### **IP地址**

每个计算机必须有一个 IP 地址才能够连入因特网。

每个 IP 包必须有一个地址才能够发送到另一台计算机。

在本教程下一节，您会学习到更多关于 IP 地址和 IP 名称的知识。
#### **IP 地址包含 4 组数字：**

TCP/IP 使用 4 组数字来为计算机编址。每个计算机必须有一个唯一的 4 组数字的地址。

每组数字必须在 0 到 255 之间，并由点号隔开，比如：192.168.1.60。
#### **32 比特 = 4 字节**

TCP/IP 使用 32 个比特来编址。一个计算机字节是 8 比特。所以 TCP/IP 使用了 4 个字节。

一个计算机字节可以包含 256 个不同的值：

00000000、00000001、00000010、00000011、00000100、00000101、00000110、00000111、00001000 ....... 直到 11111111。

现在，您应该知道了为什么 TCP/IP 地址是介于 0 到 255 之间的 4 组数字。
#### **IP V6**

IPv6 是 "Internet Protocol Version 6" 的缩写，也被称作下一代互联网协议，它是由 IETF 小组（Internet 工程任务组Internet Engineering Task Force）设计的用来替代现行的 IPv4（现行的）协议的一种新的 IP 协议。

我们知道，Internet 的主机都有一个唯一的 IP 地址，IP 地址用一个 32 位二进制的数表示一个主机号码，但 32 位地址资源有限，已经不能满足用户的需求了，因此 Internet 研究组织发布新的主机标识方法，即 IPv6。

在 RFC1884 中（RFC 是 Request for Comments document 的缩写。RFC 实际上就是 Internet 有关服务的一些标准），规定的标准语法建议把 IPv6 地址的 128 位（16 个字节）写成 8 个 16 位的无符号整数，每个整数用 4 个十六进制位表示，这些数之间用冒号（:）分开，例如：

>686E：8C64：FFFF：FFFF：0：1180：96A：FFFF

冒号十六进制记法允许零压缩，即一串连续的0可以用一对冒号取代，例如：

>FF05：0：0：0：0：0：0：B3可以定成：FF05：：B3

为了保证零压缩有一个清晰的解释，建议中规定，在任一地址中，只能使用一次零压缩。该技术对已建议的分配策略特别有用，因为会有许多地址包含连续的零串。

冒号十六进制记法结合有点十进制记法的后缀。这种结合在IPv4向IPv6换阶段特别有用。例如，下面的串是一个合法的冒号十六进制记法：

>0：0：0：0：0：0：128.10.1.1

这种记法中，虽然冒号所分隔的每一个值是一个16位的量，但每个分点十进制部分的值则指明一个字节的值。再使用零压缩即可得出：

>：：128.10.1.1

#### **域名**

12 个阿拉伯数字很难记忆。使用一个名称更容易。

用于 TCP/IP 地址的名字被称为域名。runoob.com 就是一个域名。

当你键入一个像 http://www.runoob.com 这样的域名，域名会被一种 DNS 程序翻译为数字。

在全世界，数量庞大的 DNS 服务器被连入因特网。DNS 服务器负责将域名翻译为 TCP/IP 地址，同时负责使用新的域名信息更新彼此的系统。

当一个新的域名连同其 TCP/IP 地址一起注册后，全世界的 DNS 服务器都会对此信息进行更新。
### TCP/IP 协议

TCP/IP 是不同的通信协议的大集合。
#### **协议族**

TCP/IP 是基于 TCP 和 IP 这两个最初的协议之上的不同的通信协议的大集合。
#### **TCP - 传输控制协议**

TCP 用于从应用程序到网络的数据传输控制。

TCP 负责在数据传送之前将它们分割为 IP 包，然后在它们到达的时候将它们重组。
#### **IP - 网际协议（Internet Protocol）**

IP 负责计算机之间的通信。

IP 负责在因特网上发送和接收数据包。
#### **HTTP - 超文本传输协议(Hyper Text Transfer Protocol)**

HTTP 负责 web 服务器与 web 浏览器之间的通信。

HTTP 用于从 web 客户端（浏览器）向 web 服务器发送请求，并从 web 服务器向 web 客户端返回内容（网页）。
#### **HTTPS - 安全的 HTTP（HTTP Secure）**

HTTPS 负责在 web 服务器和 web 浏览器之间的安全通信。

作为有代表性的应用，HTTPS 会用于处理信用卡交易和其他的敏感数据。
#### **SSL - 安全套接字层（Secure Sockets Layer）**

SSL 协议用于为安全数据传输加密数据。
## TCP 协议

TCP（Transmission Control Protocol，传输控制协议）是互联网协议套件中的核心协议之一，位于传输层。它提供了一种可靠的、面向连接的、基于字节流的数据传输服务。TCP 的主要特点是确保数据在传输过程中不丢失、不重复，并且按顺序到达。以下是 TCP 的工作原理和关键特性的详细解释。
### TCP 的工作原理

TCP 通过"三次握手"建立连接，通过"四次挥手"终止连接，并在数据传输过程中使用确认机制、重传机制和流量控制来保证可靠性。
1. 三次握手建立连接
![tcp握手原理](https://www.runoob.com/wp-content/uploads/2025/02/tcp-1.png)

* SYN：客户端发送一个 SYN 包（同步请求）给服务器，表示请求建立连接。
* SYN-ACK：服务器收到 SYN 包后，回复一个 SYN-ACK 包（同步确认），表示同意建立连接。
* ACK：客户端收到 SYN-ACK 包后，发送一个 ACK 包（确认），表示连接已建立。
2. 数据传输

在连接建立后，TCP 通过以下机制确保数据的可靠传输：

* 序列号和确认号：每个数据包都有一个序列号，接收方通过确认号告知发送方哪些数据已成功接收。
* 重传机制：如果发送方未收到确认，会重新发送数据包。
* 流量控制：通过滑动窗口机制，动态调整发送速率，避免接收方缓冲区溢出。
* 拥塞控制：通过慢启动、拥塞避免等算法，动态调整发送速率，避免网络拥塞。

3. 四次挥手终止连接

![tcp四次挥手](https://www.runoob.com/wp-content/uploads/2025/02/tcp-2.png)
* FIN：客户端发送一个 FIN 包，表示请求关闭连接。
* ACK：服务器收到 FIN 包后，回复一个 ACK 包，表示确认。
* FIN：服务器发送一个 FIN 包，表示服务器也准备关闭连接。
* ACK：客户端收到 FIN 包后，回复一个 ACK 包，表示确认。连接正式关闭。
## ip地址
IP 地址（Internet Protocol 地址）是用于标识计算机网络中设备的唯一地址，它允许设备在网络中互相通信。IP 地址可以分为两类：IPv4 和 IPv6。
1. IPv4 地址

IPv4 地址是最常见的 IP 地址类型，使用 32 位二进制数表示，通常被写作四组十进制数，每组数值在 0 到 255 之间，格式类似于：192.168.1.1。

    IPv4 地址的分类：IPv4 地址分为几个不同的类型：
        A 类地址：从 1.0.0.0 到 127.255.255.255，主要用于大型网络。
        B 类地址：从 128.0.0.0 到 191.255.255.255，适用于中型网络。
        C 类地址：从 192.0.0.0 到 223.255.255.255，最常用于小型网络。
        D 类地址：从 224.0.0.0 到 239.255.255.255，用于多播。
        E 类地址：从 240.0.0.0 到 255.255.255.255，保留地址，通常用于实验和研究。

    私有 IP 地址：例如 192.168.x.x 和 10.x.x.x，这些地址不能直接通过互联网访问，只能在局域网（LAN）中使用。

2. IPv6 地址

随着互联网设备数量的激增，IPv4 地址资源变得紧张，因此 IPv6 被引入作为替代方案。IPv6 地址使用 128 位二进制数表示，格式为 8 组 4 个十六进制数字，如 2001:0db8:85a3:0000:0000:8a2e:0370:7334。

    IPv6 的优势：
        更多地址：IPv6 提供了几乎无限的 IP 地址空间，能够满足未来设备联网的需求。
        更高效的路由：IPv6 简化了网络层次结构，提升了路由效率。
        内置安全性：IPv6 内置了更好的安全机制（例如 IPsec）。

3. 公有 IP 地址和私有 IP 地址

    公有 IP 地址：是互联网上唯一的地址，全球唯一，任何设备都能通过互联网访问这些地址。
    私有 IP 地址：仅限于内部网络使用，无法直接通过互联网访问。私有 IP 地址通常通过 NAT（网络地址转换）转换为公有 IP 地址，以便访问互联网。

4. 动态 IP 地址和静态 IP 地址

    动态 IP 地址：大多数互联网服务提供商（ISP）会分配动态 IP 地址，意味着每次连接网络时，分配给你的 IP 地址可能不同。动态 IP 地址的分配是通过 DHCP（动态主机配置协议）完成的。
    静态 IP 地址：是固定的 IP 地址，通常用于服务器或需要持续访问的设备。静态 IP 地址提供了更稳定的网络连接。

5. IP 地址的分配

    DHCP（动态主机配置协议）：它是一个网络协议，用于自动分配 IP 地址。当设备连接到网络时，DHCP 服务器会分配一个可用的 IP 地址。
    手动配置：某些设备（如服务器）可能需要手动配置静态 IP 地址。

6. 子网掩码（Subnet Mask）

子网掩码用于区分 IP 地址的网络部分和主机部分。通过子网掩码，可以将一个大型网络划分成多个小网络（即子网）。常见的子网掩码如 255.255.255.0，它表示前三个字节用于网络地址，最后一个字节用于主机地址。
7. NAT（网络地址转换）

NAT 是一种技术，它允许多个设备共享一个公有 IP 地址访问互联网。NAT 常用于家庭路由器中，通过它，多个设备可以使用路由器的公有 IP 地址进行互联网通信，而每个设备在内部网络中有各自的私有 IP 地址。
## 子网掩码
子网掩码（Subnet Mask）是网络中的一个重要概念，主要用于将一个大的网络划分为多个小的子网。通过子网掩码，设备可以识别一个 IP 地址中哪些部分代表网络地址，哪些部分代表主机地址。下面详细解释一下子网掩码及相关的概念。
1. 子网掩码是什么？

子网掩码是一个 32 位的二进制数，它和 IP 地址一起使用，用来区分网络部分和主机部分。通常，子网掩码与 IP 地址一样，也是用四个十进制数表示，如 255.255.255.0。

    网络部分：子网掩码中的 1 表示网络地址的部分，设备通过这部分识别属于同一子网的设备。
    主机部分：子网掩码中的 0 表示主机地址的部分，表示可以分配给设备的地址。

2. 子网掩码的工作原理

子网掩码与 IP 地址做“与运算”（bitwise AND），来确定 IP 地址中的网络部分和主机部分。简单来说，子网掩码指示了一个 IP 地址的哪些比特是网络地址，哪些比特是主机地址。

例如，如果 IP 地址是 192.168.1.10，子网掩码是 255.255.255.0，那么：

    IP 地址：192.168.1.10 对应的二进制是：11000000.10101000.00000001.00001010
    子网掩码：255.255.255.0 对应的二进制是：11111111.11111111.11111111.00000000

通过与运算，前 24 位（即 255.255.255）就可以识别出网络地址部分，而后 8 位（即 0）用于主机部分。
3. 常见的子网掩码

根据不同的需求，子网掩码的位数可以变化，通常我们使用以下几种常见的子网掩码：

    255.0.0.0 或 /8：对应 A 类网络（如 10.0.0.0），可以容纳大量主机。
    255.255.0.0 或 /16：对应 B 类网络（如 172.16.0.0），适用于中型网络。
    255.255.255.0 或 /24：对应 C 类网络（如 192.168.1.0），适用于小型局域网。

注意：/8、/16、/24 是子网掩码的简写形式，表示子网掩码中 1 的位数。例如，/24 表示子网掩码有 24 个 1，即 255.255.255.0。
4. 如何划分子网

通过子网掩码，可以将一个大的网络划分为多个小的子网。举个例子，如果我们有一个 192.168.1.0/24 网络，想要划分成更小的子网，可以选择改变子网掩码。
划分的步骤：

    确定所需子网的数量：比如需要 4 个子网。
    计算新的子网掩码：我们可以通过向子网掩码中添加更多的 1 来划分子网。例如，将 255.255.255.0 的子网掩码改为 255.255.255.192（即 /26），就可以将一个原本的子网分为 4 个子网。
    分配子网：根据新的子网掩码，可以计算出每个子网的网络地址和可用地址范围。

举例：

假设我们有 192.168.1.0/24 网络，想要划分成 4 个子网：

    新的子网掩码：255.255.255.192，即 /26。
    每个子网可以容纳 64 个地址（62 个有效主机地址），分为以下 4 个子网：
        192.168.1.0/26 网络，地址范围：192.168.1.1 到 192.168.1.62。
        192.168.1.64/26 网络，地址范围：192.168.1.65 到 192.168.1.126。
        192.168.1.128/26 网络，地址范围：192.168.1.129 到 192.168.1.190。
        192.168.1.192/26 网络，地址范围：192.168.1.193 到 192.168.1.254。

5. 子网掩码和网络划分的好处

    提高网络效率：通过子网划分，避免了广播风暴的发生，减少了网络中不必要的数据传输。
    安全性：子网划分可以限制不同子网之间的访问，提升网络的安全性。
    更好的资源管理：根据实际需求划分子网，可以使得每个子网分配到足够但不多余的 IP 地址，提高资源利用率。

6. CIDR（无类域间路由）

CIDR（Classless Inter-Domain Routing，无类域间路由）是一种不使用传统类 A、B、C 等方式的 IP 地址分配方法。CIDR 采用 /n 这种表示法（例如 192.168.1.0/24），可以灵活地进行子网划分，比传统的类网络划分更加高效。
7. 子网掩码与路由

子网掩码在路由中起着至关重要的作用。路由器通过查看 IP 地址和子网掩码来决定数据包的传输路径。通过子网掩码，路由器能判断出数据包是否属于本地网络，如果属于，则直接传送；如果不属于，则将数据包发送给默认网关进行处理。